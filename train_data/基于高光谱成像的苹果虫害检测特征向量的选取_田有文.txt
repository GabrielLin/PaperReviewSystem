第卷年第期月农业工程学报基于高光谱成像的苹果虫害检测特征向量的选取田有文程怡王小奇栗庆吉沈阳农业大学信息与电气工程学院沈阳沈阳农业大学植物保护学院沈阳摘要利用高光谱成像技术明确苹果虫害无损检测的最优特征向量以实现对苹果虫害的快速准确无损检测本文首先对波长的特征图像进行阈值分割膨胀与腐蚀运算获得掩膜图像并利用掩模图像对高光谱图像进行掩模和主成分分析对获得的第一主成分图像进行最大熵阈值分割以有效提取虫害区域然后对比分析虫害区域与正常区域图像的纹理特征提取灰度共生矩阵的个方向的个纹理参数能量熵惯性矩和相关性并且采用基于高光谱图像的光谱差值获取了个特征波长对应的光谱相对反射率作为光谱特征优化组合纹理特征和光谱特征成个特征向量组采用反向传播神经网络对正常苹果和虫害苹果进行检测结果表明融合度方向的能量熵惯性矩和相关性的纹理特征和波段的相对光谱反射率的光谱特征进行检测识别效果最好正常果的识别率为虫害果的识别率为并且速度快误差小该研究所获得的特征向量可为开发多光谱成像的苹果品质检测和分级系统提供参考关键词无损检测主成分分析图像处理光谱特征高光谱成像文献标识码文章编号中图分类号田有文程怡王小奇等基于高光谱成像的苹果虫害检测特征向量的选取农业工程学报引言中国是苹果生产大国苹果的种植面积和总产量均居世界第一然而中国苹果在国际市场上因为采后检测分级技术落后等导致品质较差在国际市场上缺乏竞争力苹果出口占总产量的比重非常低为了解决此问题就必须严格把关中国苹果的缺陷检测尤其是苹果虫害的检测苹果在生长中果实有时会受到食心虫等虫害的侵入从而使其正常新陈代谢受到干扰其生理机能组织结构等被破坏极大影响苹果的品质和销售因此苹果虫害作为苹果质量分级的重要指标之一其检测尤为重要害虫侵入苹果果实后往往在其内部进行驻洞在表面形成虫眼目前中国对水果缺陷的检测仍停留在主要依靠人工目测抽样切片或常规可见光机器视觉检测的阶段误判率收稿日期修订日期基金项目农业部公益性行业农业科研专项资助项目辽宁省教育厅科学技术研究资助项目作者简介田有文女辽宁沈阳人副教授博士后中国农业工程学会会员主要从事图谱分析在农产品品质检测的应用研究沈阳沈阳农业大学信息与电气工程学院较高且不能满足水果在线检测应具备的无损性快速性直观性等要求因此亟需开发一种快速无损高效的苹果虫害检测方法由于高光谱成像技术融合了图像处理和光谱分析的优点可以快速无损地检测研究对象内外部特性因此近年来在农产品品质与分级中获得了广泛的应用尤其为农产品受虫害后的检测带来了新的途径和方法等研究了一种受果蝇侵染的芒果高光谱图像进行分析和识别其上斑点的方法该方法经反复优化参数最终结果为最低总体识别错误率为等利用近红外光谱成像区分正常小麦与虫蛀小麦的损害使用线性判别分析和二次判别分析对健康小麦与虫蛀小麦判别结果表明正确分类率达等应用高光谱成像技术实现了对枣的外部虫害的检测总体正确识别率为等利用高光谱透视图像和反射光谱数据研究酸樱桃的内部虫害象鼻虫的无损检测采用偏最小二乘判别分析法正确识别樱桃的内部虫害的准确率分别为和在国内吴龙国等利用近红外第期田有文等基于高光谱成像的苹果虫害检测特征向量的选取高光谱成像系统采集正常长枣与虫眼枣图像利用特征波长主成分分析法结合波段比算法进行虫眼枣识别识别率达到而国内外针对苹果虫害检测的研究尚鲜有报道本文研究的目的是通过高光谱成像技术探索有效提取能正确识别苹果虫害的特征向量从而为后续实现苹果虫害的快速无损检测构建基于多光谱成像技术的苹果品质在线检测与分级系统提供理论依据材料与方法试验材料本研究选取红富士苹果作为试验的研究对象从沈阳市沈北新区苹果种植示范园采集苹果个这些果实果型匀称直径范围在质量范围在其中个为有虫害的苹果虫孔直径约另外个为正常苹果从虫害和正常苹果中各随机拣选个用于检测苹果虫害算法构建其他样本用于算法的验证高光谱成像系统本研究中高光谱成像系统如图所示整个系统由高光谱成像光谱仪一架像素像素的面阵相机一套位移台及控制平台两个的光纤卤素灯一个暗箱和一台计算机等组成高光谱摄像头的光谱范围为光谱分辨率为相机光谱仪镜头光源样本平移台位移平台控制器计算机图高光谱成像系统示意图高光谱图像采集利用高光谱成像系统获取苹果高光谱图像首先设定好物距光源强度镜头光圈度数相机曝光时间移动平台速度以确保采集的图像清晰且不失真最终确定镜头到苹果表面的距离即物距为在高光谱图像数据采集软件中设定相机曝光时间为平台移动速度为然后将反射率为标准白色校正板进行采集得到全白的标定图像再拧上镜头盖且关闭光源采集到全黑的标定图像最后逐个将苹果放置于移动平台上且有虫眼位对准镜头若是正常苹果将赤道位对准镜头通过高光谱图像数据采集软件将获得苹果每个空间位置的整个光谱区域的光谱信息高光谱图像数据处理方法数据处理采用美国美国和美国软件黑白板校正为了消除高光谱摄像头中暗电流及不均匀光强产生的噪声应对高光谱成像装置进行黑白板校正按照下列公式计算可得校正后图像式中为校正后的高光谱图像的相对反射率为原始的苹果高光谱图像为黑板标定图像为白板标定图像主成分分析主成分分析是非常有效的多变量分析技术常用来数据降维由于采集的高光谱数据首尾有噪声故本研究利用只对可见近红外光谱区域的苹果高光谱图像数据进行降维以获得各图像根据苹果各主成分图像表面虫害区域和正常区域的对比度确定用于后续分割的图像另外根据苹果高光谱图像的虫害区域与正常区域各个波段的光谱反射率的差异确定用于后续处理的特征波长并以此确定单波段特征图像图像分割方法图像分割是图像处理最重要的步骤之一此过程的精确性很大程度上影响后续的数据处理本研究分割的目的一是分割出苹果与背景二是从苹果中分割出虫害部位本文首先对特征图像采用阈值分割方法形成二值化图像并对其进行腐蚀膨胀处理获取掩膜图像然后对高光谱图像进行掩膜处理并对掩膜高光谱图像进行主成分分析确定主成分图像最后结合二值化图像对主成分图农业工程学报像进行阈值分割实现苹果虫害区域分割从而确定虫害区域的像素点位置该图像分割方法系列操作步骤如图所示连接网络它具有自组织自学习联想存储的功能和高速寻找优化解的能力在模式识别图像处理人工智能等领域有广泛的应用其主要特点是信号向前传递误差反向传播对于苹果虫害检测问题可以看作是输入苹果虫害特征到输出是否是虫害的非线性映射问题通过将学习样本提供给神经网络完成网络的训练后即可根据苹果表面的纹理与光谱表现特征通过神经网络的测试检测出苹果是否存在虫害图图像分割流程图图谱特征分析通过观察得知苹果表面虫害区域和正常区域的纹理有所差异所以采用纹理特征来描述这种差异区域灰度共生矩阵是描述图像纹理信息的有效特征反映像素相对位置的空间信息用纹理图像中某方向相隔像素距离的分别具有灰度级和一对像素出现的概率来表示即记为本研究采用描述灰度共生矩阵个纹理参数即能量熵惯性矩和相关性分别在个方向上的纹理特征参数具体计算见文献通过观察发现在苹果高光谱图像数据中每点的像素都对应于一个全波段的光谱信息如图所示苹果表面虫害区域与正常区域的光谱曲线有明显的差异因此可以分别在可见光区域和近红外区域选取相对反射率差异比较大的波段的相对反射率作为光谱特征图光谱相对反射率曲线检测模型反向传播人工神经网络是前向神经网络的有监督学习算法是由输入层输出层和若干中间隐含层组成的多层无反馈的年结果与讨论感兴趣区域光谱分析在本研究中分别提取了个苹果虫害样本和个正常苹果样本感兴趣区域的反射率光谱曲线从图中可以看出虫害区域的反射率在整个光谱区域内都比正常区域的反射率低其中处的吸收峰主要反映了苹果的表面颜色信息受苹果表面叶绿素的吸收影响的苹果受虫害侵入后在苹果表面形成孔洞此处的叶绿素严重短缺颜色与正常表面存在显著差别故处的反射率出现明显的降低而处的吸收峰则主要反映了水果表面水分含量信息受苹果表面的水分吸收影响苹果虫害区域水分比较短缺故处的光谱反射率低于苹果正常区域的光谱反射率苹果虫害区域的分割如图所示在波长处苹果表面虫害区域与正常区域的相对反射率有较大的差异因此可选取为特征波长选取波长的图像为特征图像如图所示从图中可以看出苹果区域灰度值较高而背景区域较低故可应用阈值分割该图像得到二值化图像但受苹果表面的皮孔与斑点的影响分割后的苹果区域有些噪声另外苹果边缘灰度值较低分割后较小对分割后的二值化图像进行膨胀与腐蚀运算从而得到最终的二值化图像即掩模图像如图所示并应用此二值化图像对高光谱图像进行掩膜然后对掩模后的图像进行主成分分析从图中可以看到苹果表面和范围内的噪声较大所以选取之间的波段做主成分分析得出主成分图主成分图主成分图分别如图和所示从图中可以看出图虫害区域的灰度值较高与周围的界限比较明显但图像中有与虫害区域相同的灰度值故较难分割第期田有文等基于高光谱成像的苹果虫害检测特征向量的选取出虫害区域图虫害区域的灰度值较低与周围的界限比较模糊而且图中有大量与虫害部位相似的灰度值从图像上可以明显看到一个黑点即为虫害区域与周围有非常明显的差异有特征图像二值化图像图利于苹果虫害区域的分割所以选择图作为后续处理的主成分图像结合二值化图像对图像采用最大熵阈值分割方法分割虫孔部位从而确定苹果虫害位置如图所示图图分割图像注为主成分图为主成分图为主成分图图苹果虫害区域图像分割过程系列图像特征向量的提取苹果为类球形的物体光照在整个苹果表面会呈现中间亮边缘暗的不均匀分布为使后续的检测结果受光照不均的影响最低根据图像分割出虫害像素点的位置提取其周围图像像素像素的感兴趣区域图像若是正常苹果提取图像苹果中间部分像素像素大小的感兴趣区域图像然后对感兴趣区域图像进行纹理特征分析在中计算个共生矩阵特征即能量熵惯性矩和相关性取距离为角度分别为和共个纹理特征个方向的能量熵惯性矩相关值变化趋势相同故选取有代表性的幅感兴趣区域图像的度方向的纹理特征计算结果如图所示前个样本为虫害苹果的数据后个为正常苹果的数据能量值熵惯性矩相关性注取个样本前个为虫害样本后个为正常苹果样本图共生矩阵纹理特征值由图可知虫害苹果的能量值与正常苹果的能量值有重叠但总体上虫害苹果的平均能量值约为而正常苹果的平均能量值高于虫害苹果的平均能量值约为这主要因为纹理越粗能量值越大正常苹果的纹理比虫害区域的纹理粗一些所以正常苹果的平均能量值略高于虫害苹果的农业工程学报平均能量值由图可知虫害苹果的熵值大体上比正常苹果的熵值高这主要因为图像的纹理越多熵值越大正常苹果表面光滑有较少的纹理所以熵值小一些而虫害区域的纹理较多所以熵值大一些由图可知大部分样本虫害区域的惯性矩值与正常区域的惯性矩值分布在之间数值有些波动但两个区域的平均惯性矩值相当都为左右这是因为惯性矩反映图像的清晰度虫害区域的纹理与正常区域的纹理具有同样清晰的特性所以两个区域的平均惯性矩值总体上比较接近由图可知虫害苹果的相关性值低于组别特征量第组和方向的能量熵惯性矩和相关性第组度方向的能量熵惯性矩和相关性神经网络检测分析本试验采用神经网络模型对苹果的虫害进行检测首先将试验的个训练样本的组特征分别作为人工神经网络输入矢量输入单元数与特征数一致人工神经网络隐层数为含有个神经单元输入层和隐层传递函数为正切型传递函数学习方式为加入趋势动量项的梯度下降特征组别第组第组第组第组正常苹果的相关性值这主要因为所研究的对象分布越均匀相关性值越大苹果正常部分纹理分布均匀而虫害区域的纹理与周围部分存在一定差异所以虫害苹果的相关性值低于正常苹果的相关性值根据光谱特征选择原则分别在可见光区域和近红外区域选取相对反射率差异比较大的和波段的光谱相对反射率作为光谱特征为了确定检测苹果虫害最优的特征向量本研究将纹理特征光谱特征进行优化组合分成组分别进行后续的检测试验如表所示表特征向量组合年第组和波段的相对光谱反射率表虫害苹果和正常苹果的检测结果检测精度整体检测精度均方误差正常果虫害果正常果个虫害果个正常果个验证集虫害果个训练集正常果个虫害果个正常果个验证集虫害果个正常果个虫害果个正常果个验证集虫害果个正常果个虫害果个正常果个验证集虫害果个训练集训练集训练集度方向的能量熵惯性矩和相关性和波段的相对光谱反射率的训练函数动量系数为人工神经网络的训练精度设为最大迭代次数输出层传递函数为线性传递函数包含个神经元若苹果带有虫眼输出为若为正常苹果输出为再将验证集中的测试样本通过训练好的神经网络模型进行检测检测结果如表所示检测类型样本集个第组检测时间第期田有文等基于高光谱成像的苹果虫害检测特征向量的选取表检测结果表明所有组别的虫害果被误检测为正常果的情况很少检测精度为以上而正常果被误分为虫害果的情况比较多尤其对验证集的检测利用第组和第组特征向量检测的结果最差分别为和而利用第组和第组特征向量进行检测的效果最好都达到这是因为能量熵惯性矩相关性纹理特征虽然在一定程度上能区分正常果与虫害果但有些正常果受苹果表面斑点等因素的影响有些纹理接近虫孔的纹理从而被误识为虫孔而第组和第组特征向量都包括光谱反射率的光谱特征而光谱特征选择的是正常果与虫害果光谱反射率反差比较大的波段的光谱反射率所以能比较好的区分正常果与虫害果那么从均方误差和检测时间来看利用第组特征向量进行检测的均方误差小检测时间短故最终选择第组特征向量作为检测正常果与虫害果的特征向量即度方向的能量熵惯性矩相关性及和波段的光谱相对反射率共个特征值结参文献李光辉苹果近红外无损检测技术研究杨凌西北农林科技大学黄滔滔基于技术的苹果内部品质无损检测研究杭州浙江大学地理标志产品烟台苹果楚燕杰苹果病虫害诊治原色图谱北京科学技术赵娟彭彦昆等基于机器视觉的苹文献出版社果外观缺陷在线检测农业机械学报论本文采用高光谱成像技术针对苹果虫害快速无损自动检测问题优选出能够进行虫害检测的特征向量研究表明苹果的虫害区域和正常区域的反射光谱曲线存在明显差异虫害区域的反射率在整个光谱区域内都比正常区域的反射率低其中和处有吸收峰通过波长的特征图像进行阈值分割膨胀与腐蚀运算得到二值化图像然后进行掩膜对掩模后的图像进行主成分分析并通过对获得的图像进行最大熵阈值分割能有效地分割出虫害区域利用神经网络对苹果虫害进行检测的结果表明融合度方向的能量熵惯性矩和相关性的纹理特征和波段的相对反射率的光谱特征而组成的特征向量最优正常果与虫害果识别率为并且速度快误差小有利于后续苹果虫害快速检测的多光谱图像系统的开发对于苹果的果梗花萼与缺陷进行有效的识别是在果品品质快速检测领域中一直存在的一个难题特别是针对具有相似形状和大小的果梗花萼与虫害区域的情况本文未对其检测进行研究因此如何正确识别虫害区域与果梗花萼将是未来研究的重点考刘娟娟基于红外和可见光图像融合的苹果缺陷检测方法研究南昌华东交通大学李江波饶秀勤应义斌农产品外部品质无损检测中高光谱成像技术的应用研究进展光谱学与光谱分析朱荣光马本学高振江等畜产品品质的高光谱图像无损检测研究进展激光与红外农业工程学报田有文程怡吴琼等高光谱成像技术在农产品病虫害无损检测方面的研究进展激光与红外吴龙国何建国刘贵珊等基于高光谱成像技术的长枣虫眼无损检测发光学报沈焕锋遥感影像处理方法武汉武汉大学出版社杨丹赵海滨龙哲等图像处理实例详解北京清华大学出版社黄崑骆方刘晓娟等统计分析基础教程北京清华大学出版社年章毓晋图像工程中册第二版北京清华大学出版社王凌智能优化算法及其应用北京清华大学出版社边肇祺张学工模式识别北京清华大学出版社黄文倩陈立平李江波等基于高光谱成像的苹果轻微损伤检测有效波长选取农业工程学报宋怡焕苹果果梗花萼与缺陷的纹理特征识别方法杭州浙江大学第期田有文等基于高光谱成像的苹果虫害检测特征向量的选取